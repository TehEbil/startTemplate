Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t;){if(t.matches(e))return t;t=t.parentElement}}),angular.module("ui.grid.multiselect.filter",["ngAnimate","ngTouch","ui.grid","ui.grid.selection"]).controller("multiSelectCtrl",["$scope","$compile","$timeout","$element","$attrs","$parse",function(e,t,i,l,r,o){var n,c=e.col;e.colFilter=e.col.filters[0],e.title=c.field,e.showModal=function(){e.listOfTerms=[],e.col.grid.rows.forEach(function(t){-1===e.listOfTerms.indexOf(t.entity[c.field])&&e.listOfTerms.push(t.entity[c.field])}),e.listOfTerms.sort(),e.gridOptions={data:[],enableColumnMenus:!1,onRegisterApi:function(t){e.gridApi=t,e.colFilter&&e.colFilter.listTerm&&i(function(){e.colFilter.listTerm.forEach(function(t){var i=e.gridOptions.data.filter(function(e){return e[c.field]===t});i.length>0&&e.gridApi.selection.selectRow(i[0])})})}},e.listOfTerms.forEach(function(t){var i={};i[c.field]=t,e.gridOptions.data.push(i)});var r='<div class="ui-grid-multi-select-filter"><div class="header">Filter {{title}}</div><div class="modal-body"><div class="multi-select-grid" ui-grid="gridOptions" ui-grid-selection></div></div><div class="footer"><button class="btn-close" ng-click="close()">Filter</button><button class="btn-close" ng-click="cancel()">Cancel</button></div></div>';n=angular.element(r),angular.element(l[0].closest("div[ui-grid]")).append(n),t(n)(e)},e.cancel=function(){n&&n.remove()},e.close=function(){var t=e.gridApi.selection.getSelectedRows();e.colFilter.listTerm=[],t.forEach(function(t){var i=t[c.field];"string"==typeof i&&(i=i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),e.colFilter.listTerm.push(i)}),e.colFilter.term=e.colFilter.listTerm.join(", "),e.colFilter.condition=new RegExp(e.colFilter.listTerm.join("|")),n&&n.remove(),o(r.onFilter)(e,{$terms:e.colFilter.listTerm})}}]).directive("multiSelectFilter",function(){return{template:'<button class="ui-grid-multiselect-btn" ng-class="{filtered: colFilter.listTerm.length > 0}" ng-click="showModal()">...</button>',controller:"multiSelectCtrl"}});
